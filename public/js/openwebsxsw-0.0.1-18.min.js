/* Wire stripe payments */
$(document).ready(function(){function e(e){OW.position=e.coords}function t(e){log(arguments),OW.position=null}log("Ready..."),window.OW={};if(!("ontouchstart"in window)||window.DocumentTouch&&document instanceof DocumentTouch)document.documentElement.className="no-touch";navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t("Not supported.");var n=$("#signup-form"),r=$("#signup-button");if(n.length){var i=function(e){r.attr("disabled",!0),$(".error").removeClass("error");var t=$('input[type="email"]'),i=$('input[type="name"]'),s=$('input[type="twitter"]');return i.val().length<2?(log("Bad name."),i.val("").addClass("error").focus(),r.removeAttr("disabled"),!1):/(.+)@(.+){2,}\.(.+){2,}/.test(t.val())?($("#signup-lat").val(OW.position?OW.position.latitude:""),$("#signup-lon").val(OW.position?OW.position.longitude:""),s.val(s.val().replace("@","")),$.post("/signup",n.serialize(),function(e){var t=typeof e=="string"?JSON.parse(e):e;log(t),n.find("input").val(""),r.removeAttr("disabled"),alert("Signup was successful. Stay tuned...")}),!1):(log("Bad email."),t.val("").addClass("error").focus(),r.removeAttr("disabled"),!1)};r.on("click",function(e){return i(e),e.preventDefault(),!1}),n.on("submit",function(e){return i(e),e.preventDefault(),!1})}var s=$("#stripe-button");if(s.length){var o=function(e){var t=e.id,n={amount:u.amount,currency:u.currency,card:t,description:u.description};$.post("/charge",n,function(e){var t=JSON.parse(e);log(t),alert("Payment successful! You wil now be redirected to the home page."),location.href="/"})},u={key:s[0].dataset.key,address:!1,amount:s[0].dataset.amount,name:s[0].dataset.name,description:s[0].dataset.description,currency:s[0].dataset.currency,token:o};s.on("click",function(){return StripeCheckout.open(u),!1})}})