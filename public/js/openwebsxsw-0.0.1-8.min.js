/* Wire stripe payments */
$(document).ready(function(){function e(e){OW.position=e}function t(e){log(arguments),OW.position={}}log("Ready..."),window.OW={};if(!("ontouchstart"in window)||window.DocumentTouch&&document instanceof DocumentTouch)document.documentElement.className="no-touch";navigator.geolocation?navigator.geolocation.getCurrentPosition(e,t):t("Not supported.");var n=$("#signup-form"),r=$("#signup-button");n.length&&r.on("click",function(){$(".error").removeClass("error");var e=$('input[type="email"]'),t=$('input[type="name"]');return t.val().length<2?(log("Bad name."),t.val("").addClass("error").focus(),!1):/(.+)@(.+){2,}\.(.+){2,}/.test(e.val())?($("#signup-lat").val(OW.position.coords.latitude||""),$("#signup-lon").val(OW.position.coords.longitude||""),$.post("/signup",n.serialize(),function(e){var t=JSON.parse(e);log(t),n.find("input").val(""),alert("Signup was successful. Stay tuned...")}),!1):(log("Bad email."),e.val("").addClass("error").focus(),!1)});var i=$("#stripe-button");if(i.length){var s=function(e){var t=e.id,n={amount:o.amount,currency:o.currency,card:t,description:o.description};$.post("/charge",n,function(e){var t=JSON.parse(e);log(t),alert("Payment successful! You wil now be redirected to the home page."),location.href="/"})},o={key:i[0].dataset.key,address:!1,amount:i[0].dataset.amount,name:i[0].dataset.name,description:i[0].dataset.description,currency:i[0].dataset.currency,token:s};i.on("click",function(){return StripeCheckout.open(o),!1})}})